var viewers=[];var mySwipers=[];$(function(){var a='<div class="not-supported-browser">';a+="Trình duyệt bạn đang sử dụng không hỗ trợ tính năng này. Vui lòng nâng cấp lên phiên bản mới nhất để xem được ảnh 360.";a+="</div>";var b=detectIE();if(b&&b<10){$("#titImg360").before(a);return}if($("#divPhoto360Active").length==0){return}$("#divPhoto360Active .top-controls").append('<div class="control-popup360"><span class="prev-thumb360"></span><div class="thumb-img360 swiper-container"><ul class="list-thumb360 swiper-wrapper">'+$("#photo360 .list-img ul.thumbs360").html()+'</ul></div><span class="next-thumb360"></span></div>');$(".thumbs360 li").bind("click",this,function(d){var c=$(this).siblings("li.current");if(c.length){var e=$(this).attr("data-order");$("#divPhoto360Active .list-thumb360 li").each(function(f,g){if($(g).attr("data-order")==e){$(g).siblings("li").removeClass("current");$(g).addClass("current");return false}})}clickImage360(this)});$("#divPhoto360Active .list-thumb360 li").on("click",function(){clickImage360Fullscreen(this)});$("#autoplay360").bind("click",this,function(c){if($(this).hasClass("on")){$(this).removeClass("on");$(this).addClass("off");Clock.start()}else{if($(this).hasClass("off")){$(this).removeClass("off");$(this).addClass("on");if(Clock.interval){Clock.pause()}else{Clock.resume()}}}});document.getElementById("pan-up").addEventListener("click",function(c){viewer.stopAutoRotate();viewer.setPitch(viewer.getPitch()+10)});document.getElementById("pan-down").addEventListener("click",function(c){viewer.stopAutoRotate();viewer.setPitch(viewer.getPitch()-10)});document.getElementById("pan-left").addEventListener("click",function(c){viewer.stopAutoRotate();viewer.setYaw(viewer.getYaw()-10)});document.getElementById("pan-right").addEventListener("click",function(c){viewer.stopAutoRotate();viewer.setYaw(viewer.getYaw()+10)});document.getElementById("zoom-in").addEventListener("click",function(c){viewer.stopAutoRotate();viewer.setHfov(viewer.getHfov()-10)});document.getElementById("zoom-out").addEventListener("click",function(c){viewer.stopAutoRotate();viewer.setHfov(viewer.getHfov()+10)});document.getElementById("auto-rotate").addEventListener("click",function(d){var c=viewer.getConfig();if(c&&c.autoRotate){viewer.stopAutoRotate()}else{viewer.startAutoRotate(-5)}});document.getElementById("fullscreen").addEventListener("click",function(c){$.each(viewers,function(e,f){f.toggleFullscreen()});if($("#divPhoto360Active .pnlm-render-container canvas").length){var d=$("#divPhoto360Active .pnlm-render-container canvas")[0];onResize(d,function(){if(d.width===window.innerWidth&&d.height===window.innerHeight){$("#divPhoto360Active").addClass("full-screen");createSlide360()}else{$("#divPhoto360Active").removeClass("full-screen")}})}});document.getElementById("btnCloseFullscreen").addEventListener("click",function(c){$.each(viewers,function(d,e){e.toggleFullscreen()})})});function clickImage360(j){$("#divPhoto360Active").contents(":not(.top-controls)").remove();$(j).siblings("li").removeClass("current");$(j).addClass("current");var a=-10;if($("#divPhoto360Active").hasClass("full-screen")){a=0}var e=$(j).children("img");var i=e.attr("full");if(i.indexOf("http://")==0){i=i.replace("http://","https://")}var k=e.attr("title");var c=$(j).attr("data-order");var l=parseInt(e.attr("top"),0);var b=parseInt(e.attr("bot"),0);var g=parseInt(e.attr("left"),0);var h=parseInt(e.attr("right"),0);var n=$("#divPhoto360Active").width();var m=$("#divPhoto360Active").height();var d=2*Math.atan(n/m*Math.tan((l-b)/360*Math.PI))/Math.PI*180;d=d>120?120:Math.floor(d);$("#titImg360").text(k);viewer=pannellum.viewer("divPhoto360Active",{panorama:i,autoLoad:true,showControls:false,compass:true,minYaw:g,maxYaw:h,minPitch:b,maxPitch:l,maxHfov:d,northOffset:0,orientationOnByDefault:true});viewer.id="viewer"+c;var f=false;$.each(viewers,function(o,p){if($(p).attr("id")==viewer.id){f=true}});if(!f){viewers.push(viewer)}viewer.on("load",function(){$(".pnlm-compass").removeClass("pnlm-controls");$(".pnlm-compass").removeClass("pnlm-control");$(".pnlm-compass").html('<i class="icon-deg360"></i>');$(".pnlm-compass").after('<div class="control-img360"><i class="icon-scan360"></i></div>')});viewer.startAutoRotate(-5)}function clickImage360Fullscreen(c){var a=$(c).siblings("li.current");if(a.length){$(c).siblings("li").removeClass("current");$(c).addClass("current");var b=$(c).attr("data-order");$("#photo360 .list-img ul#thumbs li").each(function(d,e){if($(e).attr("data-order")==b){clickImage360(e);return false}})}}function createSlide360(){mySwiper=new Swiper(".swiper-container",{slidesPerView:8,spaceBetween:1,calculateHeight:true,direction:"vertical",loop:false,pagination:false,autoResize:true,autoplay:false,onInit:function(a){if(a.imagesLoaded<=8){$(".next-thumb360").hide();$(".prev-thumb360").hide()}viewer.stopAutoRotate()}});$(".list-thumb360.swiper-wrapper").width($(".list-thumb360.swiper-wrapper").width()+100);$(".list-thumb360.swiper-wrapper").height(70);$(".list-thumb360.swiper-wrapper li").height(65);$("#divPhoto360Active .next-thumb360").on("click",function(){mySwiper.swipeNext()});$("#divPhoto360Active .prev-thumb360").on("click",function(){mySwiper.swipePrev()})}function onResize(b,a){var c=b.height,d=b.width;setInterval(function(){if(b.height!==c||b.width!==d){c=b.height;d=b.width;a()}},300)}var Clock={totalSeconds:863,start:function(){var a=this;this.interval=setInterval(function(){a.totalSeconds-=1;if(parseInt(a.totalSeconds%72)==0){var c=$("#photo360 .list-img .thumbs360 li.current");if(c.length){var e=c.next("li");if(e.length){$(e).trigger("click");var b=viewer.getConfig();if(b&&!b.autoRotate){$("#auto-rotate").trigger("click")}}else{var f=c.siblings("li");if(f.length){var d=f[0];$(d).trigger("click");var b=viewer.getConfig();if(b&&!b.autoRotate){$("#auto-rotate").trigger("click")}}}}}},1000)},pause:function(){clearInterval(this.interval);delete this.interval},resume:function(){if(!this.interval){this.start()}}};function detectIE(){var e=window.navigator.userAgent;var b=e.indexOf("MSIE ");if(b>0){return parseInt(e.substring(b+5,e.indexOf(".",b)),10)}var d=e.indexOf("Trident/");if(d>0){var c=e.indexOf("rv:");return parseInt(e.substring(c+3,e.indexOf(".",c)),10)}var a=e.indexOf("Edge/");if(a>0){return parseInt(e.substring(a+5,e.indexOf(".",a)),10)}return false};